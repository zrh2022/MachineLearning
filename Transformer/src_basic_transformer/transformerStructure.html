<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformeræ¶æ„å›¾ - å¼ é‡å½¢çŠ¶æ ‡æ³¨</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }

        .legend {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .legend h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        .legend-item {
            display: inline-block;
            margin: 5px 15px 5px 0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .tensor-shape { background: #e8f4f8; color: #2980b9; }
        .operation { background: #e8f8f5; color: #27ae60; }
        .layer { background: #fef9e7; color: #d68910; }
        .attention { background: #fdedec; color: #e74c3c; }

        .architecture-container {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            margin-top: 30px;
        }

        .encoder-section, .decoder-section {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .section-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .layer-stack {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .transformer-layer {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .transformer-layer:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .layer-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.1em;
        }

        .sublayer {
            background: #f1f2f6;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            position: relative;
        }

        .sublayer-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .tensor-flow {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.85em;
        }

        .tensor-step {
            padding: 6px 10px;
            border-radius: 6px;
            background: white;
            border: 1px solid #ddd;
            position: relative;
        }

        .input-step { border-left: 4px solid #3498db; }
        .attention-step { border-left: 4px solid #e74c3c; }
        .ffn-step { border-left: 4px solid #27ae60; }
        .output-step { border-left: 4px solid #9b59b6; }

        .shape-tag {
            background: #2980b9;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 8px;
        }

        .arrow {
            text-align: center;
            font-size: 1.5em;
            color: #7f8c8d;
            margin: 5px 0;
        }

        .connection-line {
            position: absolute;
            width: 2px;
            background: #3498db;
            left: 50%;
            transform: translateX(-50%);
        }

        .input-embedding, .output-embedding {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #3498db;
        }

        .nx-label {
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .cross-attention {
            position: relative;
        }

        .cross-attention::before {
            content: "æ¥è‡ªç¼–ç å™¨";
            position: absolute;
            right: -80px;
            top: 50%;
            transform: translateY(-50%);
            background: #f39c12;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            white-space: nowrap;
        }

        @media (max-width: 1024px) {
            .architecture-container {
                flex-direction: column;
            }

            .cross-attention::before {
                display: none;
            }
        }

        .note-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .note-box h4 {
            margin-top: 0;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Transformeræ¶æ„å›¾</h1>
        <div class="subtitle">åŸºäº"Attention is All You Need"è®ºæ–‡ - è¯¦ç»†å¼ é‡å½¢çŠ¶æ ‡æ³¨</div>

        <div class="legend">
            <h3>ğŸ“‹ ç¬¦å·è¯´æ˜</h3>
            <div class="legend-item tensor-shape">B = batch_size</div>
            <div class="legend-item tensor-shape">S_src = æºåºåˆ—é•¿åº¦</div>
            <div class="legend-item tensor-shape">S_tgt = ç›®æ ‡åºåˆ—é•¿åº¦</div>
            <div class="legend-item tensor-shape">d_model = 512 (æ¨¡å‹ç»´åº¦)</div>
            <div class="legend-item tensor-shape">h = 8 (æ³¨æ„åŠ›å¤´æ•°)</div>
            <div class="legend-item tensor-shape">d_k = 64 (æ¯å¤´ç»´åº¦)</div>
            <div class="legend-item tensor-shape">d_ff = 2048 (å‰é¦ˆç»´åº¦)</div>
            <div class="legend-item tensor-shape">V = è¯æ±‡è¡¨å¤§å°</div>
        </div>

        <div class="architecture-container">
            <!-- ç¼–ç å™¨éƒ¨åˆ† -->
            <div class="encoder-section">
                <div class="section-title">ğŸ”¢ ç¼–ç å™¨ (Encoder)</div>

                <div class="input-embedding">
                    <div class="sublayer-title">ğŸ“ è¾“å…¥å¤„ç†</div>
                    <div class="tensor-flow">
                        <div class="tensor-step input-step">
                            è¾“å…¥Token ID <span class="shape-tag">[B, S_src]</span>
                        </div>
                        <div class="arrow">â†“</div>
                        <div class="tensor-step input-step">
                            è¯åµŒå…¥ Ã— âˆšd_model <span class="shape-tag">[B, S_src, d_model]</span>
                        </div>
                        <div class="arrow">+</div>
                        <div class="tensor-step input-step">
                            ä½ç½®ç¼–ç  <span class="shape-tag">[B, S_src, d_model]</span>
                        </div>
                    </div>
                </div>

                <div class="layer-stack">
                    <div class="transformer-layer">
                        <div class="nx-label">NÃ—6</div>
                        <div class="layer-name">ğŸ—ï¸ ç¼–ç å™¨å±‚</div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ”„ å¤šå¤´è‡ªæ³¨æ„åŠ›</div>
                            <div class="tensor-flow">
                                <div class="tensor-step attention-step">
                                    è¾“å…¥ <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    Q,K,Vå˜æ¢ <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    å¤šå¤´é‡å¡‘ <span class="shape-tag">[B, h, S_src, d_k]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    æ³¨æ„åŠ›æƒé‡ <span class="shape-tag">[B, h, S_src, S_src]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    æ‹¼æ¥è¾“å‡º <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="tensor-flow">
                                <div class="tensor-step output-step">
                                    æ®‹å·® + å±‚å½’ä¸€åŒ– <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ§  å‰é¦ˆç½‘ç»œ</div>
                            <div class="tensor-flow">
                                <div class="tensor-step ffn-step">
                                    ç¬¬ä¸€å±‚ + ReLU <span class="shape-tag">[B, S_src, d_ff]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step ffn-step">
                                    ç¬¬äºŒå±‚ <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="tensor-flow">
                                <div class="tensor-step output-step">
                                    æ®‹å·® + å±‚å½’ä¸€åŒ– <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-embedding">
                    <div class="sublayer-title">ğŸ“¤ ç¼–ç å™¨è¾“å‡º</div>
                    <div class="tensor-flow">
                        <div class="tensor-step output-step">
                            Memory (K,V) <span class="shape-tag">[B, S_src, d_model]</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è§£ç å™¨éƒ¨åˆ† -->
            <div class="decoder-section">
                <div class="section-title">ğŸ¯ è§£ç å™¨ (Decoder)</div>

                <div class="output-embedding">
                    <div class="sublayer-title">ğŸ“ è¾“å‡ºå¤„ç†</div>
                    <div class="tensor-flow">
                        <div class="tensor-step input-step">
                            è¾“å‡ºToken ID (å³ç§») <span class="shape-tag">[B, S_tgt]</span>
                        </div>
                        <div class="arrow">â†“</div>
                        <div class="tensor-step input-step">
                            è¯åµŒå…¥ Ã— âˆšd_model <span class="shape-tag">[B, S_tgt, d_model]</span>
                        </div>
                        <div class="arrow">+</div>
                        <div class="tensor-step input-step">
                            ä½ç½®ç¼–ç  <span class="shape-tag">[B, S_tgt, d_model]</span>
                        </div>
                    </div>
                </div>

                <div class="layer-stack">
                    <div class="transformer-layer">
                        <div class="nx-label">NÃ—6</div>
                        <div class="layer-name">ğŸ—ï¸ è§£ç å™¨å±‚</div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ”’ æ©ç å¤šå¤´è‡ªæ³¨æ„åŠ›</div>
                            <div class="tensor-flow">
                                <div class="tensor-step attention-step">
                                    è¾“å…¥ <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    Q,K,Vå˜æ¢ <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    å¤šå¤´é‡å¡‘ <span class="shape-tag">[B, h, S_tgt, d_k]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    æ©ç æ³¨æ„åŠ› <span class="shape-tag">[B, h, S_tgt, S_tgt]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    æ‹¼æ¥è¾“å‡º <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="tensor-flow">
                                <div class="tensor-step output-step">
                                    æ®‹å·® + å±‚å½’ä¸€åŒ– <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer cross-attention">
                            <div class="sublayer-title">ğŸ”„ ç¼–ç å™¨-è§£ç å™¨æ³¨æ„åŠ›</div>
                            <div class="tensor-flow">
                                <div class="tensor-step attention-step">
                                    Qæ¥è‡ªè§£ç å™¨ <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                                <div class="tensor-step attention-step">
                                    K,Væ¥è‡ªç¼–ç å™¨ <span class="shape-tag">[B, S_src, d_model]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    å¤šå¤´é‡å¡‘ Q<span class="shape-tag">[B, h, S_tgt, d_k]</span>
                                </div>
                                <div class="tensor-step attention-step">
                                    å¤šå¤´é‡å¡‘ K,V<span class="shape-tag">[B, h, S_src, d_k]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    äº¤å‰æ³¨æ„åŠ› <span class="shape-tag">[B, h, S_tgt, S_src]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step attention-step">
                                    æ‹¼æ¥è¾“å‡º <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="tensor-flow">
                                <div class="tensor-step output-step">
                                    æ®‹å·® + å±‚å½’ä¸€åŒ– <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ§  å‰é¦ˆç½‘ç»œ</div>
                            <div class="tensor-flow">
                                <div class="tensor-step ffn-step">
                                    ç¬¬ä¸€å±‚ + ReLU <span class="shape-tag">[B, S_tgt, d_ff]</span>
                                </div>
                                <div class="arrow">â†“</div>
                                <div class="tensor-step ffn-step">
                                    ç¬¬äºŒå±‚ <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="tensor-flow">
                                <div class="tensor-step output-step">
                                    æ®‹å·® + å±‚å½’ä¸€åŒ– <span class="shape-tag">[B, S_tgt, d_model]</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="output-embedding">
                    <div class="sublayer-title">ğŸ“¤ è¾“å‡ºæŠ•å½±</div>
                    <div class="tensor-flow">
                        <div class="tensor-step output-step">
                            çº¿æ€§æŠ•å½± <span class="shape-tag">[B, S_tgt, V]</span>
                        </div>
                        <div class="arrow">â†“</div>
                        <div class="tensor-step output-step">
                            Softmaxæ¦‚ç‡ <span class="shape-tag">[B, S_tgt, V]</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-box">
            <h4>ğŸ” å…³é”®æŠ€æœ¯ç»†èŠ‚</h4>
            <ul>
                <li><strong>å¤šå¤´æ³¨æ„åŠ›ï¼š</strong> å°† d_model åˆ†å‰²ä¸º h ä¸ª d_k ç»´åº¦çš„å¤´ï¼Œå¹¶è¡Œè®¡ç®—æ³¨æ„åŠ›</li>
                <li><strong>ä½ç½®ç¼–ç ï¼š</strong> ä½¿ç”¨æ­£å¼¦å’Œä½™å¼¦å‡½æ•°ä¸ºæ¯ä¸ªä½ç½®ç”Ÿæˆå”¯ä¸€ç¼–ç </li>
                <li><strong>æ®‹å·®è¿æ¥ï¼š</strong> æ¯ä¸ªå­å±‚éƒ½æœ‰æ®‹å·®è¿æ¥ï¼Œå¸®åŠ©æ¢¯åº¦æµåŠ¨å’Œè®­ç»ƒç¨³å®šæ€§</li>
                <li><strong>å±‚å½’ä¸€åŒ–ï¼š</strong> åœ¨æ¯ä¸ªæ®‹å·®è¿æ¥åè¿›è¡Œå±‚å½’ä¸€åŒ–ï¼ŒåŠ é€Ÿæ”¶æ•›</li>
                <li><strong>æ©ç æœºåˆ¶ï¼š</strong> è§£ç å™¨ä½¿ç”¨ä¸‹ä¸‰è§’æ©ç é˜²æ­¢çœ‹åˆ°æœªæ¥ä¿¡æ¯</li>
                <li><strong>æƒé‡å…±äº«ï¼š</strong> è¾“å‡ºåµŒå…¥å±‚å’Œè¾“å‡ºæŠ•å½±å±‚å…±äº«æƒé‡å‚æ•°</li>
            </ul>
        </div>
    </div>
</body>
</html>