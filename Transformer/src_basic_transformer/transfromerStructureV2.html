<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transformeræ¶æ„å›¾ - è¯¦ç»†è®¡ç®—è¿‡ç¨‹</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }

        .legend {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .legend h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        .legend-item {
            display: inline-block;
            margin: 5px 15px 5px 0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .tensor-shape { background: #e8f4f8; color: #2980b9; }
        .operation { background: #e8f8f5; color: #27ae60; }

        .architecture-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
        }

        .encoder-section, .decoder-section {
            flex: 1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .section-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .layer-stack {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .transformer-layer {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .transformer-layer:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .layer-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-size: 1.1em;
        }

        .sublayer {
            background: #f1f2f6;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            position: relative;
        }

        .sublayer-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .computation-flow {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.8em;
        }

        .computation-step {
            background: white;
            border-radius: 6px;
            padding: 8px 10px;
            border: 1px solid #ddd;
            position: relative;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 4px 0;
            font-weight: bold;
            font-size: 0.85em;
        }

        .tensor-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-top: 5px;
            font-size: 0.75em;
        }

        .tensor-var {
            background: #3498db;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            text-align: center;
        }

        .tensor-shape-info {
            background: #e74c3c;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            text-align: center;
        }

        .input-step { border-left: 4px solid #3498db; }
        .attention-step { border-left: 4px solid #e74c3c; }
        .ffn-step { border-left: 4px solid #27ae60; }
        .output-step { border-left: 4px solid #9b59b6; }

        .arrow {
            text-align: center;
            font-size: 1.2em;
            color: #7f8c8d;
            margin: 3px 0;
        }

        .input-embedding, .output-embedding {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #3498db;
        }

        .nx-label {
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .cross-attention {
            position: relative;
            border: 2px dashed #f39c12;
        }

        .cross-attention::before {
            content: "æ¥è‡ªç¼–ç å™¨è¾“å‡º";
            position: absolute;
            right: -90px;
            top: 10px;
            background: #f39c12;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.7em;
            white-space: nowrap;
        }

        .matrix-mult {
            background: #8e44ad;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin: 0 3px;
        }

        .softmax-op {
            background: #e67e22;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin: 0 3px;
        }

        .relu-op {
            background: #27ae60;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin: 0 3px;
        }

        .layernorm-op {
            background: #34495e;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin: 0 3px;
        }

        @media (max-width: 1200px) {
            .architecture-container {
                flex-direction: column;
            }

            .cross-attention::before {
                position: relative;
                right: auto;
                top: auto;
                display: block;
                margin-bottom: 8px;
            }
        }

        .note-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .note-box h4 {
            margin-top: 0;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ Transformeræ¶æ„å›¾</h1>
        <div class="subtitle">è¯¦ç»†è®¡ç®—è¿‡ç¨‹ä¸å¼ é‡å½¢çŠ¶ - "Attention is All You Need"</div>

        <div class="legend">
            <h3>ğŸ“‹ ç¬¦å·è¯´æ˜</h3>
            <div class="legend-item tensor-shape">B = batch_size</div>
            <div class="legend-item tensor-shape">S_src = æºåºåˆ—é•¿åº¦</div>
            <div class="legend-item tensor-shape">S_tgt = ç›®æ ‡åºåˆ—é•¿åº¦</div>
            <div class="legend-item tensor-shape">d_model = 512</div>
            <div class="legend-item tensor-shape">h = 8 (æ³¨æ„åŠ›å¤´æ•°)</div>
            <div class="legend-item tensor-shape">d_k = d_v = 64</div>
            <div class="legend-item tensor-shape">d_ff = 2048</div>
            <div class="legend-item tensor-shape">V = è¯æ±‡è¡¨å¤§å°</div>
        </div>

        <div class="architecture-container">
            <!-- ç¼–ç å™¨éƒ¨åˆ† -->
            <div class="encoder-section">
                <div class="section-title">ğŸ”¢ ç¼–ç å™¨ (Encoder)</div>

                <div class="input-embedding">
                    <div class="sublayer-title">ğŸ“ è¾“å…¥å¤„ç†</div>
                    <div class="computation-flow">
                        <div class="computation-step input-step">
                            <div class="formula">è¾“å…¥: tokens</div>
                            <div class="tensor-info">
                                <div class="tensor-var">tokens</div>
                                <div class="tensor-shape-info">[B, S_src]</div>
                            </div>
                        </div>

                        <div class="arrow">â†“</div>

                        <div class="computation-step input-step">
                            <div class="formula">embed = E[tokens] Ã— âˆšd_model</div>
                            <div class="tensor-info">
                                <div class="tensor-var">E</div>
                                <div class="tensor-shape-info">[V, d_model]</div>
                                <div class="tensor-var">embed</div>
                                <div class="tensor-shape-info">[B, S_src, d_model]</div>
                            </div>
                        </div>

                        <div class="arrow">+</div>

                        <div class="computation-step input-step">
                            <div class="formula">PE(pos,2i) = sin(pos/10000^(2i/d_model))</div>
                            <div class="formula">PE(pos,2i+1) = cos(pos/10000^(2i/d_model))</div>
                            <div class="tensor-info">
                                <div class="tensor-var">PE</div>
                                <div class="tensor-shape-info">[1, S_src, d_model]</div>
                            </div>
                        </div>

                        <div class="arrow">â†“</div>

                        <div class="computation-step input-step">
                            <div class="formula">X = embed + PE</div>
                            <div class="tensor-info">
                                <div class="tensor-var">X</div>
                                <div class="tensor-shape-info">[B, S_src, d_model]</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="layer-stack">
                    <div class="transformer-layer">
                        <div class="nx-label">NÃ—6</div>
                        <div class="layer-name">ğŸ—ï¸ ç¼–ç å™¨å±‚</div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ”„ å¤šå¤´è‡ªæ³¨æ„åŠ›</div>
                            <div class="computation-flow">
                                <div class="computation-step attention-step">
                                    <div class="formula">Q = X Ã— W_Q, K = X Ã— W_K, V = X Ã— W_V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">X</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                        <div class="tensor-var">W_Q,W_K,W_V</div>
                                        <div class="tensor-shape-info">[d_model, d_model]</div>
                                        <div class="tensor-var">Q,K,V</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">Q,K,V â†’ reshape â†’ [B, S_src, h, d_k] â†’ transpose â†’ [B, h, S_src, d_k]</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Q,K,V (multi-head)</div>
                                        <div class="tensor-shape-info">[B, h, S_src, d_k]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">scores = (Q Ã— K^T) / âˆšd_k</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Q</div>
                                        <div class="tensor-shape-info">[B, h, S_src, d_k]</div>
                                        <div class="tensor-var">K^T</div>
                                        <div class="tensor-shape-info">[B, h, d_k, S_src]</div>
                                        <div class="tensor-var">scores</div>
                                        <div class="tensor-shape-info">[B, h, S_src, S_src]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">attn_weights = <span class="softmax-op">Softmax</span>(scores)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">attn_weights</div>
                                        <div class="tensor-shape-info">[B, h, S_src, S_src]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">head_out = attn_weights Ã— V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">attn_weights</div>
                                        <div class="tensor-shape-info">[B, h, S_src, S_src]</div>
                                        <div class="tensor-var">V</div>
                                        <div class="tensor-shape-info">[B, h, S_src, d_k]</div>
                                        <div class="tensor-var">head_out</div>
                                        <div class="tensor-shape-info">[B, h, S_src, d_k]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">concat_out = Concat(head_out) Ã— W_O</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">concat_out</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                        <div class="tensor-var">W_O</div>
                                        <div class="tensor-shape-info">[d_model, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="computation-flow">
                                <div class="computation-step output-step">
                                    <div class="formula">Xâ‚ = <span class="layernorm-op">LayerNorm</span>(X + concat_out)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Xâ‚</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ§  å‰é¦ˆç½‘ç»œ</div>
                            <div class="computation-flow">
                                <div class="computation-step ffn-step">
                                    <div class="formula">hidden = <span class="relu-op">ReLU</span>(Xâ‚ Ã— Wâ‚ + bâ‚)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Xâ‚</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                        <div class="tensor-var">Wâ‚</div>
                                        <div class="tensor-shape-info">[d_model, d_ff]</div>
                                        <div class="tensor-var">bâ‚</div>
                                        <div class="tensor-shape-info">[d_ff]</div>
                                        <div class="tensor-var">hidden</div>
                                        <div class="tensor-shape-info">[B, S_src, d_ff]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step ffn-step">
                                    <div class="formula">ffn_out = hidden Ã— Wâ‚‚ + bâ‚‚</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Wâ‚‚</div>
                                        <div class="tensor-shape-info">[d_ff, d_model]</div>
                                        <div class="tensor-var">bâ‚‚</div>
                                        <div class="tensor-shape-info">[d_model]</div>
                                        <div class="tensor-var">ffn_out</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="computation-flow">
                                <div class="computation-step output-step">
                                    <div class="formula">Xâ‚‚ = <span class="layernorm-op">LayerNorm</span>(Xâ‚ + ffn_out)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Xâ‚‚</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-embedding">
                    <div class="sublayer-title">ğŸ“¤ ç¼–ç å™¨è¾“å‡º</div>
                    <div class="computation-flow">
                        <div class="computation-step output-step">
                            <div class="formula">Memory = Xâ‚‚ (æœ€ç»ˆç¼–ç å™¨å±‚è¾“å‡º)</div>
                            <div class="tensor-info">
                                <div class="tensor-var">Memory</div>
                                <div class="tensor-shape-info">[B, S_src, d_model]</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è§£ç å™¨éƒ¨åˆ† -->
            <div class="decoder-section">
                <div class="section-title">ğŸ¯ è§£ç å™¨ (Decoder)</div>

                <div class="output-embedding">
                    <div class="sublayer-title">ğŸ“ è¾“å‡ºå¤„ç†</div>
                    <div class="computation-flow">
                        <div class="computation-step input-step">
                            <div class="formula">è¾“å…¥: tgt_tokens (å³ç§»)</div>
                            <div class="tensor-info">
                                <div class="tensor-var">tgt_tokens</div>
                                <div class="tensor-shape-info">[B, S_tgt]</div>
                            </div>
                        </div>

                        <div class="arrow">â†“</div>

                        <div class="computation-step input-step">
                            <div class="formula">tgt_embed = E[tgt_tokens] Ã— âˆšd_model</div>
                            <div class="tensor-info">
                                <div class="tensor-var">E</div>
                                <div class="tensor-shape-info">[V, d_model]</div>
                                <div class="tensor-var">tgt_embed</div>
                                <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                            </div>
                        </div>

                        <div class="arrow">+</div>

                        <div class="computation-step input-step">
                            <div class="formula">Y = tgt_embed + PE</div>
                            <div class="tensor-info">
                                <div class="tensor-var">Y</div>
                                <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="layer-stack">
                    <div class="transformer-layer">
                        <div class="nx-label">NÃ—6</div>
                        <div class="layer-name">ğŸ—ï¸ è§£ç å™¨å±‚</div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ”’ æ©ç å¤šå¤´è‡ªæ³¨æ„åŠ›</div>
                            <div class="computation-flow">
                                <div class="computation-step attention-step">
                                    <div class="formula">Q = Y Ã— W_Q, K = Y Ã— W_K, V = Y Ã— W_V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Q,K,V</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">Q,K,V â†’ [B, h, S_tgt, d_k]</div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">scores = (Q Ã— K^T) / âˆšd_k + mask</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">mask</div>
                                        <div class="tensor-shape-info">[S_tgt, S_tgt] (ä¸‹ä¸‰è§’)</div>
                                        <div class="tensor-var">scores</div>
                                        <div class="tensor-shape-info">[B, h, S_tgt, S_tgt]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">masked_attn_out = <span class="softmax-op">Softmax</span>(scores) Ã— V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">masked_attn_out</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="computation-flow">
                                <div class="computation-step output-step">
                                    <div class="formula">Yâ‚ = <span class="layernorm-op">LayerNorm</span>(Y + masked_attn_out)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Yâ‚</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer cross-attention">
                            <div class="sublayer-title">ğŸ”„ ç¼–ç å™¨-è§£ç å™¨æ³¨æ„åŠ›</div>
                            <div class="computation-flow">
                                <div class="computation-step attention-step">
                                    <div class="formula">Q = Yâ‚ Ã— W_Q</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Q</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>

                                <div class="computation-step attention-step">
                                    <div class="formula">K = Memory Ã— W_K, V = Memory Ã— W_V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Memory</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                        <div class="tensor-var">K,V</div>
                                        <div class="tensor-shape-info">[B, S_src, d_model]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">Q â†’ [B, h, S_tgt, d_k], K,V â†’ [B, h, S_src, d_k]</div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">cross_scores = (Q Ã— K^T) / âˆšd_k</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">cross_scores</div>
                                        <div class="tensor-shape-info">[B, h, S_tgt, S_src]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step attention-step">
                                    <div class="formula">cross_attn_out = <span class="softmax-op">Softmax</span>(cross_scores) Ã— V</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">cross_attn_out</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="computation-flow">
                                <div class="computation-step output-step">
                                    <div class="formula">Yâ‚‚ = <span class="layernorm-op">LayerNorm</span>(Yâ‚ + cross_attn_out)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Yâ‚‚</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">ğŸ§  å‰é¦ˆç½‘ç»œ</div>
                            <div class="computation-flow">
                                <div class="computation-step ffn-step">
                                    <div class="formula">hidden = <span class="relu-op">ReLU</span>(Yâ‚‚ Ã— Wâ‚ + bâ‚)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Yâ‚‚</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                        <div class="tensor-var">Wâ‚</div>
                                        <div class="tensor-shape-info">[d_model, d_ff]</div>
                                        <div class="tensor-var">hidden</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_ff]</div>
                                    </div>
                                </div>

                                <div class="arrow">â†“</div>

                                <div class="computation-step ffn-step">
                                    <div class="formula">ffn_out = hidden Ã— Wâ‚‚ + bâ‚‚</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Wâ‚‚</div>
                                        <div class="tensor-shape-info">[d_ff, d_model]</div>
                                        <div class="tensor-var">ffn_out</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sublayer">
                            <div class="sublayer-title">âš¡ Add & Norm</div>
                            <div class="computation-flow">
                                <div class="computation-step output-step">
                                    <div class="formula">Yâ‚ƒ = <span class="layernorm-op">LayerNorm</span>(Yâ‚‚ + ffn_out)</div>
                                    <div class="tensor-info">
                                        <div class="tensor-var">Yâ‚ƒ</div>
                                        <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="output-embedding">
                    <div class="sublayer-title">ğŸ“¤ è¾“å‡ºæŠ•å½±</div>
                    <div class="computation-flow">
                        <div class="computation-step output-step">
                            <div class="formula">logits = Yâ‚ƒ Ã— W_out</div>
                            <div class="tensor-info">
                                <div class="tensor-var">Yâ‚ƒ</div>
                                <div class="tensor-shape-info">[B, S_tgt, d_model]</div>
                                <div class="tensor-var">W_out</div>
                                <div class="tensor-shape-info">[d_model, V]</div>
                                <div class="tensor-var">logits</div>
                                <div class="tensor-shape-info">[B, S_tgt, V]</div>
                            </div>
                        </div>

                        <div class="arrow">â†“</div>

                        <div class="computation-step output-step">
                            <div class="formula">probs = <span class="softmax-op">Softmax</span>(logits)</div>
                            <div class="tensor-info">
                                <div class="tensor-var">probs</div>
                                <div class="tensor-shape-info">[B, S_tgt, V]</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-box">
            <h4>ğŸ” å…³é”®è®¡ç®—å…¬å¼è¯¦è§£</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                <div>
                    <h5>ğŸ¯ æ³¨æ„åŠ›æœºåˆ¶æ ¸å¿ƒå…¬å¼:</h5>
                    <div class="formula">Attention(Q,K,V) = Softmax(QK^T/âˆšd_k)V</div>
                    <ul style="font-size: 0.9em; margin-top: 10px;">
                        <li>Q: æŸ¥è¯¢çŸ©é˜µ [B, h, S_q, d_k]</li>
                        <li>K: é”®çŸ©é˜µ [B, h, S_k, d_k]</li>
                        <li>V: å€¼çŸ©é˜µ [B, h, S_v, d_k]</li>
                        <li>âˆšd_k: ç¼©æ”¾å› å­ï¼Œé˜²æ­¢softmaxé¥±å’Œ</li>
                    </ul>
                </div>
                <div>
                    <h5>ğŸ”„ å¤šå¤´æ³¨æ„åŠ›:</h5>
                    <div class="formula">MultiHead(Q,K,V) = Concat(headâ‚,...,head_h)W^O</div>
                    <div class="formula">head_i = Attention(QW^Q_i, KW^K_i, VW^V_i)</div>
                    <ul style="font-size: 0.9em; margin-top: 10px;">
                        <li>h = 8 ä¸ªå¹¶è¡Œçš„æ³¨æ„åŠ›å¤´</li>
                        <li>æ¯ä¸ªå¤´å¤„ç† d_k = d_model/h = 64 ç»´</li>
                        <li>æœ€åæ‹¼æ¥å¹¶æŠ•å½±å› d_model ç»´</li>
                    </ul>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                <div>
                    <h5>ğŸ§  ä½ç½®å‰é¦ˆç½‘ç»œ:</h5>
                    <div class="formula">FFN(x) = max(0, xWâ‚ + bâ‚)Wâ‚‚ + bâ‚‚</div>
                    <ul style="font-size: 0.9em; margin-top: 10px;">
                        <li>ç¬¬ä¸€å±‚: [d_model] â†’ [d_ff] (2048ç»´)</li>
                        <li>ReLUæ¿€æ´»å‡½æ•°</li>
                        <li>ç¬¬äºŒå±‚: [d_ff] â†’ [d_model]</li>
                    </ul>
                </div>
                <div>
                    <h5>ğŸ“ å±‚å½’ä¸€åŒ–:</h5>
                    <div class="formula">LayerNorm(x) = Î³ Ã— (x-Î¼)/Ïƒ + Î²</div>
                    <ul style="font-size: 0.9em; margin-top: 10px;">
                        <li>Î¼: è¾“å…¥çš„å‡å€¼</li>
                        <li>Ïƒ: è¾“å…¥çš„æ ‡å‡†å·®</li>
                        <li>Î³,Î²: å¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°</li>
                        <li>å½’ä¸€åŒ–åœ¨æœ€åä¸€ä¸ªç»´åº¦(d_model)ä¸Šè¿›è¡Œ</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 15px;">
                <h5>ğŸ­ æ©ç æœºåˆ¶:</h5>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div>
                        <strong>ç¼–ç å™¨è‡ªæ³¨æ„åŠ›:</strong>
                        <div class="formula">mask = None (å…¨è¿æ¥)</div>
                    </div>
                    <div>
                        <strong>è§£ç å™¨è‡ªæ³¨æ„åŠ›:</strong>
                        <div class="formula">mask[i,j] = 0 if j > i (ä¸‹ä¸‰è§’)</div>
                    </div>
                    <div>
                        <strong>äº¤å‰æ³¨æ„åŠ›:</strong>
                        <div class="formula">mask = padding_mask (å¯é€‰)</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 15px;">
                <h5>ğŸ“Š å…³é”®æŠ€æœ¯ç‚¹:</h5>
                <ul style="font-size: 0.9em; columns: 2; column-gap: 20px;">
                    <li><strong>æƒé‡å…±äº«:</strong> è¾“å‡ºåµŒå…¥å±‚ä¸è¾“å‡ºæŠ•å½±å±‚å…±äº«æƒé‡ W_out = E^T</li>
                    <li><strong>è¯åµŒå…¥ç¼©æ”¾:</strong> åµŒå…¥å‘é‡ä¹˜ä»¥âˆšd_model æå‡è®­ç»ƒç¨³å®šæ€§</li>
                    <li><strong>æ®‹å·®è¿æ¥:</strong> æ¯ä¸ªå­å±‚éƒ½æœ‰ x + SubLayer(x) çš„æ®‹å·®è¿æ¥</li>
                    <li><strong>Dropout:</strong> æ³¨æ„åŠ›æƒé‡ã€å‰é¦ˆç½‘ç»œã€åµŒå…¥å±‚éƒ½åº”ç”¨dropout</li>
                    <li><strong>ä½ç½®ç¼–ç :</strong> ä½¿ç”¨å›ºå®šçš„æ­£å¼¦ä½™å¼¦å‡½æ•°ç¼–ç ä½ç½®ä¿¡æ¯</li>
                    <li><strong>å­¦ä¹ ç‡è°ƒåº¦:</strong> è®ºæ–‡ä½¿ç”¨ç‰¹æ®Šçš„warmupå­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>